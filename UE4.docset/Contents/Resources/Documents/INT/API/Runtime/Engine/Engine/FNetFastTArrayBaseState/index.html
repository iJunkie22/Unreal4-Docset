<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
		"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr" lang="en-US">
<head>
<title>FNetFastTArrayBaseState</title>
<link rel="stylesheet" type="text/css" href="./../../../../../../Include/CSS/udn_public.css">
<link rel="stylesheet" type="text/css" href="./../../../../../../Include/CSS/udn_public_nosidebar.css" />
<link rel="stylesheet" type="text/css" href="./../../../../../../Include/CSS/jquery-ui-1.10.3.custom.css">
<style type="text/css">
#jumplink
{
	visibility:hidden;
}
</style>
<Script src="./../../../../../../Include/Javascript/jquery-1.7.1.min.js" type="text/javascript"></Script>
<Script src="./../../../../../../Include/Javascript/jquery-ui-1.10.3.custom.min.js" type="text/javascript"></Script>
<Script src="./../../../../../../Include/Javascript/udn.js" type="text/javascript"></Script>
<Script src="./../../../../../../Include/Javascript/jquery.fancybox-1.3.4.pack.js" type="text/javascript"></Script>
<link rel="stylesheet" type="text/css" href="./../../../../../../Include/CSS/jquery.fancybox-1.3.4.css">

<link rel="icon" href="./../../../../../../Include/Images/favicon.ico" type="image/x-icon" />
<link rel="shortcut icon" href="./../../../../../../Include/Images/favicon.ico" type="image/x-icon" />

<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="title" content="FNetFastTArrayBaseState" />
<meta name="crumbs" content="%ROOT%, API, API\Runtime, API\Runtime\Engine, API\Runtime\Engine\Engine" />
<meta name="description" content="Copyright 1998-2015 Epic Games, Inc. All Rights Reserved." />
<meta name="availability" content="Public" />


</head>
<body id="webbgThree">
    <!-- Google Tag Manager -->
    <noscript>
        <iframe src="//www.googletagmanager.com/ns.html?id=GTM-KWRD6D"
                height="0" width="0" style="display:none;visibility:hidden"></iframe>
    </noscript>
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || []; w[l].push({
                'gtm.start':
                new Date().getTime(), event: 'gtm.js'
            }); var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
            '//www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', 'GTM-KWRD6D');</script>
    <!-- End Google Tag Manager -->
    
    <div id="webThree">
        
        <div id="contentContainer">
            <div id="pagedefault">
                <div id="pagecontainer">
                    <div id="pagenav">
                        <div style="clear:both;">
                            <!-- Start of crumbs links -->
                            <div class="crumbs">
    <div id="jumplink" onclick="$('#sidebar').toggle();">
        Jump To
    </div>
    <p> <strong><a id="content_link" href="../../../../index.html" >Unreal Engine API Reference</a></strong> &gt; <strong><a id="content_link" href="../../../index.html" >Runtime</a></strong> &gt; <strong><a id="content_link" href="../../index.html" >Engine</a></strong> &gt; <strong><a id="content_link" href="../index.html" >Engine</a></strong> &gt; <span id="crumbs_page_title">FNetFastTArrayBaseState</span></p>
</div>
                            <!-- End of crumbs links -->
                        </div>
                    </div>
                    <div id="maincol">
                        <!-- Start of H1 -->
                        <h1 id="H1TitleId">FNetFastTArrayBaseState</h1>
                        <!-- End of H1 -->
                        <!-- Start of Markdown converted page content -->
                        <div class="heading expanded" onclick="sectionOnClick(this, 'hierarchy');">
        <p>Inheritance Hierarchy</p>
    </div>
<div id="hierarchy">
    <div class="hierarchy">
	<table class="hierarchy-table" cellspacing="0" id="hrch"><tr><td class="hierarchy-button-cell"><p><img class="hierarchy-spacer" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="> </p></td><td class="hierarchy-label-cell"><a href="../../../CoreUObject/UObject/INetDeltaBaseState/index.html"><p>INetDeltaBaseState</p></a><table class="hierarchy-table" cellspacing="0" id="hrch_1"><tr><td class="hierarchy-button-cell"><p><img class="hierarchy-spacer" src="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw=="> </p></td><td class="hierarchy-label-cell"><p>FNetFastTArrayBaseState</p></td></tr></table></td></tr></table>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'syntax');">
        <p>Syntax</p>
    </div>
<div id="syntax">
    <div class="simplecode_api">
	<p>class FNetFastTArrayBaseState : public <a id="content_link" href="../../../CoreUObject/UObject/INetDeltaBaseState/index.html" >INetDeltaBaseState</a><br /></p>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'description');">
        <p>Remarks</p>
    </div>
<div id="description">
    <p>============================================================================= NetworkSerialization.h: Contains custom network serialization functionality. 
</p><p>===================== NetSerialize and NetDeltaSerialize customization. =====================
</p><p>The main purpose of this file it to hold custom methods for NetSerialization and NetDeltaSerialization. A longer explanation on how this all works is covered below. For quick reference however, this is how to customize net serialization for structs.
</p><p>To define your own NetSerialize and NetDeltaSerialize on a structure: (of course you don't need to define both&#33; Usually you only want to define one, but for brevity Im showing both at once) ===================== Fast <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray</a> Replication =====================
</p><p>Fast <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray</a> Replication is a custom implementation of NetDeltaSerialize that is suitable for TArrays of UStructs. It offers performance improvements for large data sets, it serializes removals from anywhere in the array optimally, and allows events to be called on clients for adds and removals. The downside is that you will need to have game code mark items in the array as dirty, and well as the <em>order</em> of the list is not guaranteed to be identical between client and server in all cases.
</p><p>Using FTR is more complicated, but this is the code you need:Step 6 and beyond: -Declare a UPROPERTY of your FExampleArray (step 2) type. -You MUST call MarkItemDirty on the FExampleArray when you change an item in the array. You pass in a reference to the item you dirtied. See <a id="content_link" href="../FFastArraySerializer/MarkItemDirty/index.html" >FFastArraySerializer::MarkItemDirty</a>. -You MUST call MarkArrayDirty on the FExampleArray if you remove something from the array. -In your classes GetLifetimeReplicatedProps, use DOREPLIFETIME(YourClass, YourArrayStructPropertyName);
</p><p>You can override the following virtual functions in your structure (step 1) to get notifies before add/deletes/removes: -void PreReplicatedRemove(const FFastArraySerializer&amp; Serializer) -void PostReplicatedAdd(const FFastArraySerializer&amp; Serializer) -void PostReplicatedChange(const FFastArraySerializer&amp; Serializer)
</p><p>Thats it&#33;
</p><p>===================== An Overview of Net Serialization and how this all works ===================== Everything originates in UNetDriver::ServerReplicateActors.
Actors are chosen to replicate, create actor channels, and UActorChannel::ReplicateActor is called.
ReplicateActor is ultimately responsible for deciding what properties have changed, and constructing a FOutBUnch to send to clients.
</p><p>The <a id="content_link" href="../UActorChannel/index.html" >UActorChannel</a> has 2 ways to decide what properties need to be sent. The traditional way, which is a flat <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray&lt;uint8&gt;</a> buffer: UActorChannel::Recent. This represents a flat block of the actor properties. This block literally can be cast to an AActor&#42; and property values can be looked up if you know the <a id="content_link" href="../../../CoreUObject/UObject/UProperty/index.html" >UProperty</a> offset. The Recent buffer represents the values that the client using this actor channel has. We use recent to compare to current, and decide what to send.
</p><p>This works great for 'atomic' properties; ints, floats, object&#42;, etc. It does not work for 'dynamic' properties such as TArrays, which store values Num/Max but also a pointer to their array data, The array data has no where to fit in the flat ::Recent buffer. (Dynamic is probably a bad name for these properties)
</p><p>To get around this, <a id="content_link" href="../UActorChannel/index.html" >UActorChannel</a> also has a <a id="content_link" href="../../../Core/Containers/TMap/index.html" >TMap</a> for 'dynamic' state. UActorChannel::RecentDynamicState. This map allows us to look up a 'base state' for a property given a property's RepIndex.
</p><p>NetSerialize &amp; NetDeltaSerialize Properties that fit into the flat Recent buffer can be serialized entirely with NetSerialize. NetSerialize just reads or writes to an <a id="content_link" href="../../../Core/Serialization/FArchive/index.html" >FArchive</a>. Since the replication can just look at the Recent[] buffer and do a direct comparison, it can tell what properties are dirty. NetSerialize just reads or writes.
</p><p>Dynamic properties can only be serialized with NetDeltaSerialize. NetDeltaSerialize is serialization from a given base state, and produces both a 'delta' state (which gets sent to the client) and a 'full' state (which is saved to be used as the base state in future delta serializes). NetDeltaSerialize essentially does the diffing as well as the serialization. It must do the diffing so it can know what parts of the property it must send.
</p><p>Base States and dynamic properties replication. As far as the replication system / <a id="content_link" href="../UActorChannel/index.html" >UActorChannel</a> is concerned, a base state can be anything. The base state only deals with INetDeltaBaseState&#42;.
</p><p><a id="content_link" href="../UActorChannel/ReplicateActor/index.html" >UActorChannel::ReplicateActor</a> will ultimately decide whether to call <a id="content_link" href="../../../CoreUObject/UObject/UProperty/NetSerializeItem/index.html" >UProperty::NetSerializeItem</a> or UProperty::NetDeltaSerializeItem.
</p><p>As mentioned above NetDeltaSerialize takes in an extra base state and produces a diff state and a full state. The full state produced is used as the base state for future delta serialization. NetDeltaSerialize uses the base state and the current values of the actor to determine what parts it needs to send.
</p><p>The INetDeltaBaseStates are created within the NetDeltaSerialize functions. The replication system / <a id="content_link" href="../UActorChannel/index.html" >UActorChannel</a> does not know about the details.
</p><p>Right now, there are 2 forms of delta serialization: Generic Replication and Fast Array Replication.
</p><p>Generic Delta Replication Generic Delta Replication is implemented by UStructProperty::NetDeltaSerializeItem, UArrayProperty::NetDeltaSerializeItem, UProperty::NetDeltaSerializeItem. It works by first NetSerializing the current state of the object (the 'full' state) and using memcmp to compare it to previous base state. <a id="content_link" href="../../../CoreUObject/UObject/UProperty/index.html" >UProperty</a> is what actually implements the comparison, writing the current state to the diff state if it has changed, and always writing to the full state otherwise. The <a id="content_link" href="../../../CoreUObject/UObject/UStructProperty/index.html" >UStructProperty</a> and <a id="content_link" href="../../../CoreUObject/UObject/UArrayProperty/index.html" >UArrayProperty</a> functions work by iterating their fields or array elements and calling the <a id="content_link" href="../../../CoreUObject/UObject/UProperty/index.html" >UProperty</a> function, while also embedding meta data.
</p><p>For example <a id="content_link" href="../../../CoreUObject/UObject/UArrayProperty/index.html" >UArrayProperty</a> basically writes: "Array has X elements now" -&gt; "Here is element Y" -&gt; Output from UProperty::NetDeltaSerialize -&gt; "Here is element Z" -&gt; etc
</p><p>Generic Data Replication is the 'default' way of handling <a id="content_link" href="../../../CoreUObject/UObject/UArrayProperty/index.html" >UArrayProperty</a> and <a id="content_link" href="../../../CoreUObject/UObject/UStructProperty/index.html" >UStructProperty</a> serialization. This will work for any array or struct with any sub properties as long as those properties can NetSerialize.
</p><p>Custom Net Delta Serialiation Custom Net Delta Serialiation works by using the struct trait system. If a struct has the WithNetDeltaSerializer trait, then its native NetDeltaSerialize function will be called instead of going through the Generic Delta Replication code path in UStructProperty::NetDeltaSerializeItem.
</p><p>Fast <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray</a> Replication Fast <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray</a> Replication is implemented through custom net delta serialization. Instead of a flat <a id="content_link" href="../../../Core/Containers/TArray/index.html" >TArray</a> buffer to repesent states, it only is concerned with a <a id="content_link" href="../../../Core/Containers/TMap/index.html" >TMap</a> of IDs and ReplicationKeys. The IDs map to items in the array, which all have a ReplicationID field defined in <a id="content_link" href="../FFastArraySerializerItem/index.html" >FFastArraySerializerItem</a>. <a id="content_link" href="../FFastArraySerializerItem/index.html" >FFastArraySerializerItem</a> also has a ReplicationKey field. When items are marked dirty with MarkItemDirty, they are given a new ReplicationKey, and assigned a new ReplicationID if they don't have one.
</p><p>FastArrayDeltaSerialize (defined below) During server serialization (writing), we compare the old base state (e.g, the old ID&lt;-&gt;Key map) with the current state of the array. If items are missing we write them out as deletes in the bunch. If they are new or changed, they are written out as changed along with their state, serialized via a NetSerialize call.
</p><p>For example, what actually is written may look like: "Array has X changed elements, Y deleted elements" -&gt; "element A changed" -&gt; Output from NetSerialize on rest of the struct item -&gt; "Element B was deleted" -&gt; etc
</p><p>Note that the ReplicationID is replicated and in sync between client and server. The indices are not.
</p><p>During client serialization (reading), the client reads in the number of changed and number of deleted elements. It also builds a mapping of ReplicationID -&gt; local index of the current array. As it deserializes IDs, it looks up the element and then does what it needs to (create if necessary, serialize in the current state, or delete).
</p><p>There is currently no delta serialization done on the inner structures. If a ReplicationKey changes, the entire item is serialized. If we had use cases where we needed it, we could delta serialization on the inner dynamic properties. This could be done with more struct customization.
</p><p>ReplicationID and ReplicationKeys are set by the MarkItemDirty function on <a id="content_link" href="../FFastArraySerializer/index.html" >FFastArraySerializer</a>. These are just int32s that are assigned in order as things change. There is nothing special about them other than being unique.Custom <a id="content_link" href="../../../CoreUObject/UObject/INetDeltaBaseState/index.html" >INetDeltaBaseState</a> used by Fast Array Serialization</p>
</div><div class="syntax">
	<div class="heading expanded" onclick="sectionOnClick(this, 'variables');">
        <p>Variables</p>
    </div>
<div id="variables">
    <div class="member-list">
	<table cellspacing="0">
		<tr class="header-row">
			<th class="icon-cell" style="width:8%">
			</th>
			<th class="type-cell" style="width:10%">
			</th>
			<th class="name-cell" style="width:15%">
				Name
			</th>
			<th class="desc-cell">
				Description
			</th>
		</tr><tr class="normal-row">
	<td class="icon-cell">
		<p><img alt="Public variable" title="Public variable" width="18" src="./../../../../../../images/./api_variable_public.png" /></p>
	</td>
	<td class="name-cell" align="right">
		<span class="type-span"><p>int32</p></span>&nbsp;
	</td>
	<td class="name-cell">
		<p>ArrayReplicationKey</p>
	</td>
	<td class="desc-cell">
		
	</td>
</tr><tr class="normal-row">
	<td class="icon-cell">
		<p><img alt="Public variable" title="Public variable" width="18" src="./../../../../../../images/./api_variable_public.png" /></p>
	</td>
	<td class="name-cell" align="right">
		<span class="type-span"><p><a id="content_link" href="../../../Core/Containers/TMap/index.html" >TMap</a>&lt; int32, in...</p></span>&nbsp;
	</td>
	<td class="name-cell">
		<a href="IDToCLMap/index.html"><p>IDToCLMap</p></a>
	</td>
	<td class="desc-cell">
		
	</td>
</tr></table>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'constructor');">
        <p>Constructors</p>
    </div>
<div id="constructor">
    <div class="member-list">
	<table cellspacing="0">
		<tr class="header-row">
			<th class="icon-cell" style="width:10%">
			</th>
			<th class="name-cell" style="width:15%;">
				Name
			</th>
			<th class="desc-cell">
				Description
			</th>
		</tr><tr class="normal-row">
	<td class="icon-cell">
		<p><img alt="Public function" title="Public function" width="18" src="./../../../../../../images/./api_function_public.png" /></p>
	</td>
	<td class="name-cell">
		<a href="__ctor/index.html"><nobr><p>FNetFastTArrayBaseState()</p></nobr></a>
		<div class="name-cell-arguments">
			
		</div>
	</td>
	<td class="desc-cell">
		
	</td>
</tr></table>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'functions_1');">
        <p>Overridden from INetDeltaBaseState</p>
    </div>
<div id="functions_1">
    <div class="member-list">
	<table cellspacing="0">
		<tr class="header-row">
			<th class="icon-cell" style="width:10%">
			</th>
			<th class="name-cell" style="width:8%;">
			</th>
			<th class="name-cell" style="width:15%;">
				Name
			</th>
			<th class="desc-cell">
				Description
			</th>
		</tr><tr class="normal-row">
	<td class="icon-cell">
		<p><img alt="Public function" title="Public function" width="18" src="./../../../../../../images/./api_function_public.png" />
<img alt="Virtual" title="Virtual" width="18" src="./../../../../../../images/./api_function_virtual.png" /></p>
	</td>
	<td class="name-cell" align="right">
		<span class="type-span"><p>bool</p></span>&nbsp;
	</td>
	<td class="name-cell">
		<a href="IsStateEqual/index.html"><nobr><p>IsStateEqual</p></nobr></a>
		<div class="name-cell-arguments">
			<p>&#40;<br />&nbsp;&nbsp;&nbsp;&nbsp;<a id="content_link" href="../../../CoreUObject/UObject/INetDeltaBaseState/index.html" >INetDeltaBaseState</a>&#42; OtherState<br />&#41;  </p>
		</div>
	</td>
	<td class="desc-cell">
		
	</td>
</tr></table>
</div>
</div>
</div><div class="heading expanded" onclick="sectionOnClick(this, 'references');">
        <p>References</p>
    </div>
<div id="references">
    <div class="member-list">
	<table cellspacing="0"><tr class="normal-row">
	<td class="name-cell">
		<p>Module</p>
	</td>
	<td class="desc-cell">
		<p><a id="content_link" href="../../index.html" >Engine</a></p>
	</td>
</tr><tr class="normal-row">
	<td class="name-cell">
		<p>Header</p>
	</td>
	<td class="desc-cell">
		<p>Runtime&#47;Engine&#47;Classes&#47;Engine&#47;NetSerialization.h</p>
	</td>
</tr></table>
</div>
</div>
                        <!-- End of Markdown converted page content -->
                        
                    </div>
                </div>
            </div>
            <div id="footer">
                <div style="BACKGROUND-COLOR: transparent; margin: 0; padding: 0; width: 100%;border-top:1px solid #000000;">
                    <div style="text-align: center; vertical-align: bottom; width: 100%;">
                        Copyright &copy; 2001-2015 <a href="http://www.epicgames.com" target="_top">Epic Games, Inc.</a> | <a href="./../../../../../../INT/DevelopmentRoles/BusinessAndLegal/TermsAndConditions/index.html" class="twikiLink">Terms and Conditions</a> | <a href="http://epicgames.com/privacynotice" target="_top">Privacy Notice</a>
                    </div>
                </div>
            </div>
        </div>
    </div></body>
</html>
